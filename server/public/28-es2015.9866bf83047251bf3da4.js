(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{zuTJ:function(t,e,o){"use strict";o.r(e);var n=o("ofXK"),i=o("TEn/"),s=o("3Pt+"),c=o("tyNb"),r=o("mrSG"),a=o("HDdC"),b=o("J07l"),l=o("lNB8"),u=o("VOof"),h=o("fXoL"),d=o("7JkF");function m(t,e){1&t&&(h.Mb(0,"ion-header"),h.Mb(1,"ion-toolbar",1),h.Mb(2,"ion-title"),h.lc(3,"Crar Nuevo Chat"),h.Lb(),h.Lb(),h.Lb())}function g(t,e){1&t&&(h.Mb(0,"ion-header"),h.Mb(1,"ion-toolbar",1),h.Mb(2,"ion-title"),h.lc(3,"Crar Nuevo Cliente"),h.Lb(),h.Lb(),h.Lb())}function p(t,e){if(1&t){const t=h.Nb();h.Mb(0,"ion-item"),h.Mb(1,"ion-checkbox",6),h.Ub("ionChange",(function(e){return h.hc(t),h.Wb(2).selection(e)})),h.Lb(),h.Mb(2,"ion-label"),h.Mb(3,"strong"),h.lc(4),h.Lb(),h.Kb(5,"br"),h.Mb(6,"p"),h.lc(7,"Agregar al chat"),h.Lb(),h.Lb(),h.Lb()}if(2&t){const t=e.$implicit;h.zb(1),h.dc("value",t.ID),h.zb(3),h.mc(t.Name)}}function f(t,e){if(1&t){const t=h.Nb();h.Mb(0,"ion-item"),h.Mb(1,"ion-checkbox",6),h.Ub("ionChange",(function(e){return h.hc(t),h.Wb(2).selection(e)})),h.Lb(),h.Mb(2,"ion-label"),h.Mb(3,"strong"),h.lc(4),h.Lb(),h.Kb(5,"br"),h.Mb(6,"p"),h.lc(7,"Agregar al chat"),h.Lb(),h.Lb(),h.Lb()}if(2&t){const t=e.$implicit;h.zb(1),h.dc("value",t.ID),h.zb(3),h.mc(t.name)}}function M(t,e){if(1&t){const t=h.Nb();h.Mb(0,"ion-content"),h.Mb(1,"ion-list"),h.Mb(2,"ion-item"),h.Mb(3,"ion-input",2),h.Ub("ngModelChange",(function(e){return h.hc(t),h.Wb().usersSelect.name=e})),h.Lb(),h.Lb(),h.Mb(4,"ion-slides",3),h.Mb(5,"ion-slide"),h.Mb(6,"ion-item-divider",4),h.Mb(7,"h4"),h.lc(8,"Usuario de mi empresa"),h.Lb(),h.Lb(),h.kc(9,p,8,2,"ion-item",5),h.Lb(),h.Mb(10,"ion-slide"),h.Mb(11,"ion-item-divider",4),h.Mb(12,"h4"),h.lc(13,"Clientes de mi Empresa"),h.Lb(),h.Lb(),h.kc(14,f,8,2,"ion-item",5),h.Lb(),h.Lb(),h.Lb(),h.Lb()}if(2&t){const t=h.Wb();h.zb(3),h.cc("ngModel",t.usersSelect.name),h.zb(6),h.cc("ngForOf",t.users),h.zb(5),h.cc("ngForOf",t.customers)}}function C(t,e){if(1&t){const t=h.Nb();h.Mb(0,"ion-content"),h.Mb(1,"ion-list"),h.Mb(2,"ion-item"),h.Mb(3,"ion-input",7),h.Ub("ngModelChange",(function(e){return h.hc(t),h.Wb().customer.name=e})),h.Lb(),h.Lb(),h.Mb(4,"ion-item"),h.Mb(5,"ion-input",8),h.Ub("ngModelChange",(function(e){return h.hc(t),h.Wb().customer.login=e})),h.Lb(),h.Lb(),h.Mb(6,"ion-item"),h.Mb(7,"ion-input",9),h.Ub("ngModelChange",(function(e){return h.hc(t),h.Wb().customer.clave=e})),h.Lb(),h.Lb(),h.Lb(),h.Lb()}if(2&t){const t=h.Wb();h.zb(3),h.cc("ngModel",t.customer.name),h.zb(2),h.cc("ngModel",t.customer.login),h.zb(2),h.cc("ngModel",t.customer.clave)}}function L(t,e){if(1&t){const t=h.Nb();h.Mb(0,"ion-footer"),h.Mb(1,"ion-toolbar",4),h.Mb(2,"ion-title"),h.lc(3,"Crar nuevo chat"),h.Lb(),h.Mb(4,"ion-buttons",10),h.Mb(5,"ion-button",11),h.Ub("click",(function(){return h.hc(t),h.Wb().createdChat()})),h.Kb(6,"ion-icon",12),h.Lb(),h.Lb(),h.Lb(),h.Lb()}}function v(t,e){if(1&t){const t=h.Nb();h.Mb(0,"ion-footer"),h.Mb(1,"ion-toolbar",4),h.Mb(2,"ion-buttons",10),h.Mb(3,"ion-button",11),h.Ub("click",(function(){return h.hc(t),h.Wb().createdCustomer()})),h.Kb(4,"ion-icon",12),h.Lb(),h.Lb(),h.Lb(),h.Lb()}}let y=(()=>{class t{constructor(t,e,o,n){this.apiService=t,this.storage=e,this.socket=o,this.modalCtrl=n,this.users=[],this.usersSelect={name:"Mi sala de chat",users:[]},this.customer={name:"",login:"",clave:"",company:"",userID:""},this.customers=[]}ngOnInit(){}ionViewWillEnter(){return Object(r.a)(this,void 0,void 0,(function*(){if("chat"===this.type){this.usersSelect={name:"Mi sala de chat",users:[]};const t=yield this.storage.getLogin();t&&(console.log(t[0]),this.apiService.getCustomersCompany(t[0].CompanyID).subscribe(t=>{console.log(t,"DaTAMAN"),"ok"===t.status&&(t.response.length>0&&t.response.forEach(t=>{t.ID=t.login,this.customers.push(t)}),this.customers=t.response)}),this.apiService.getUsersCompany({AccessToken:t[0].AccessToken}).subscribe(e=>{e=JSON.parse(e),console.log(e),this.users=e[0],this.users=this.users.filter(e=>e.ID!==t[0].UserID),this.usersSelect.users.push(t[0].UserID)}))}}))}selection(t){t.detail.checked?this.usersSelect.users.push(t.detail.value):this.usersSelect.users=this.usersSelect.users.filter(e=>e!==t.detail.value)}createdChat(){this.socket.emit("chat",this.usersSelect),this.modalCtrl.dismiss({status:"ok"})}createdCustomer(){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.storage.getLogin();t&&(console.log(t[0]),this.customer.company=t[0].CompanyID,this.customer.userID=t[0].UserID,this.apiService.createdCustomer(this.customer).subscribe(t=>{console.log(t," data mas"),this.modalCtrl.dismiss("ok"===t.status?{status:"ok"}:{status:"error",error:t.error})}))}))}}return t.\u0275fac=function(e){return new(e||t)(h.Jb(b.a),h.Jb(u.a),h.Jb(d.a),h.Jb(i.Y))},t.\u0275cmp=h.Db({type:t,selectors:[["app-chat-modal"]],inputs:{type:"type"},decls:6,vars:6,consts:[[4,"ngIf"],["color","danger"],["type","text","placeholder","Nombre de la sala de chat",3,"ngModel","ngModelChange"],[1,"slides"],["color","light"],[4,"ngFor","ngForOf"],["slot","start",3,"value","ionChange"],["type","text","placeholder","Nombre del Cliente",3,"ngModel","ngModelChange"],["type","text","placeholder","Login del Cliente",3,"ngModel","ngModelChange"],["type","password","placeholder","Contrase\xf1a del Cliente",3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["name","add-outline","slot","icon-only"]],template:function(t,e){1&t&&(h.kc(0,m,4,0,"ion-header",0),h.kc(1,g,4,0,"ion-header",0),h.kc(2,M,15,3,"ion-content",0),h.kc(3,C,8,3,"ion-content",0),h.kc(4,L,7,0,"ion-footer",0),h.kc(5,v,5,0,"ion-footer",0)),2&t&&(h.cc("ngIf","chat"===e.type),h.zb(1),h.cc("ngIf","customer"===e.type),h.zb(1),h.cc("ngIf","chat"===e.type),h.zb(1),h.cc("ngIf","customer"===e.type),h.zb(1),h.cc("ngIf","chat"===e.type),h.zb(1),h.cc("ngIf","customer"===e.type))},directives:[n.i,i.s,i.T,i.S,i.l,i.B,i.v,i.u,i.fb,s.c,s.d,i.O,i.N,i.w,n.h,i.i,i.b,i.A,i.q,i.h,i.g,i.t],styles:["ion-item[_ngcontent-%COMP%]{margin:3px 5px!important}.slides[_ngcontent-%COMP%]{width:100%;min-height:100%;height:auto}.slides[_ngcontent-%COMP%]   ion-slide[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.slides[_ngcontent-%COMP%]   ion-slide[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{width:100%}"]}),t})();var k=o("w9U0");function U(t,e){if(1&t&&(h.Mb(0,"ion-title"),h.lc(1),h.Lb()),2&t){const t=h.Wb();h.zb(1),h.oc(" Hablando con ",t.chatUser.FirstName," ",t.chatUser.LastName," ")}}function O(t,e){1&t&&(h.Mb(0,"ion-title"),h.lc(1," Modulo Chat "),h.Lb())}function w(t,e){if(1&t){const t=h.Nb();h.Mb(0,"ion-item",3),h.Ub("click",(function(){h.hc(t);const o=e.$implicit;return h.Wb().saveChat(o.parentChat._id)})),h.Kb(1,"ion-icon",13),h.Mb(2,"ion-label"),h.lc(3),h.Lb(),h.Lb()}if(2&t){const t=e.$implicit;h.zb(3),h.mc(t.parentChat.name)}}function I(t,e){if(1&t){const t=h.Nb();h.Mb(0,"ion-fab-button",14),h.Ub("click",(function(){return h.hc(t),h.Wb().createdCustomer()})),h.Kb(1,"ion-icon",15),h.Lb()}}let z=(()=>{class t{constructor(t,e,o,n,i,s,c,r){this.socket=t,this.toastCtrl=e,this.alertCtrl=o,this.dataCompany=n,this.apiService=i,this.storage=s,this.modalCtrl=c,this.router=r,this.mensajes=[],this.nombreUsuario="",this.chatUser="",this.listChat=[],this.RoleCA=!1,this.newChat().subscribe(()=>{this.loadChats()})}ionViewDidEnter(){return Object(r.a)(this,void 0,void 0,(function*(){this.loadChats()}))}loadChats(){return Object(r.a)(this,void 0,void 0,(function*(){this.dataCompany.getVista("2");const t=yield this.storage.getLogin();t&&(this.RoleCA="CA"===t[0].ROLE,"exter"===t[0].type?this.apiService.getChats(t[0].login).subscribe(t=>{this.listChat=t.response}):"inter"===t[0].type&&this.apiService.getChats(t[0].UserID).subscribe(t=>{this.listChat=t.response}))}))}createdChat(){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.modalCtrl.create({component:y,componentProps:{type:"chat"}});yield t.present();const e=yield t.onWillDismiss();if(e){console.log("Michat",e);const t=yield this.storage.getLogin();t&&setTimeout(()=>{this.apiService.getChats(t[0].UserID).subscribe(t=>{this.listChat=t.response,console.log(t," data"),console.log(t.response)})},1e3)}}))}createdCustomer(){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.modalCtrl.create({component:y,componentProps:{type:"customer"}});yield t.present();const e=yield t.onWillDismiss();e&&e.data&&("ok"===e.data.status?this.toastCtrl.newCreatedToast("Cliente creado con \xe9xito",!0):"error"===e.data.status&&this.toastCtrl.newCreatedToast("No se pudo crear el cliente",!0))}))}saveChat(t){return Object(r.a)(this,void 0,void 0,(function*(){(yield this.storage.insertChat(t))&&this.router.navigate(["/messages"])}))}newChat(){return new a.a(t=>{this.socket.on("newchat",e=>{t.next(e)})})}}return t.\u0275fac=function(e){return new(e||t)(h.Jb(d.a),h.Jb(k.a),h.Jb(i.a),h.Jb(l.a),h.Jb(b.a),h.Jb(u.a),h.Jb(i.Y),h.Jb(c.f))},t.\u0275cmp=h.Db({type:t,selectors:[["app-home"]],decls:17,vars:4,consts:[["color","danger"],[4,"ngIf"],["slot","end"],[3,"click"],["name","refresh-outline","slot","icon-only"],["color","light"],[3,"click",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],["side","top"],["color","light",3,"click"],["name","chatbubble-outline"],["color","secondary",3,"click",4,"ngIf"],["name","chatbubble-outline","slot","start"],["color","secondary",3,"click"],["name","person-add-outline"]],template:function(t,e){1&t&&(h.Mb(0,"ion-header"),h.Mb(1,"ion-toolbar",0),h.kc(2,U,2,2,"ion-title",1),h.kc(3,O,2,0,"ion-title",1),h.Mb(4,"ion-buttons",2),h.Mb(5,"ion-button",3),h.Ub("click",(function(){return e.loadChats()})),h.Kb(6,"ion-icon",4),h.Lb(),h.Lb(),h.Lb(),h.Lb(),h.Mb(7,"ion-content",5),h.Mb(8,"ion-list"),h.kc(9,w,4,1,"ion-item",6),h.Lb(),h.Mb(10,"ion-fab",7),h.Mb(11,"ion-fab-button",0),h.Kb(12,"ion-icon",8),h.Lb(),h.Mb(13,"ion-fab-list",9),h.Mb(14,"ion-fab-button",10),h.Ub("click",(function(){return e.createdChat()})),h.Kb(15,"ion-icon",11),h.Lb(),h.kc(16,I,2,0,"ion-fab-button",12),h.Lb(),h.Lb(),h.Lb()),2&t&&(h.zb(2),h.cc("ngIf",""!==e.chatUser),h.zb(1),h.cc("ngIf",""==e.chatUser),h.zb(6),h.cc("ngForOf",e.listChat),h.zb(7),h.cc("ngIf",e.RoleCA))},directives:[i.s,i.T,n.i,i.h,i.g,i.t,i.l,i.B,n.h,i.n,i.o,i.p,i.S,i.v,i.A],styles:[".verde[_ngcontent-%COMP%]{background:#fbd4d4!important}.message[_ngcontent-%COMP%]{margin-top:10px;background:#e9e9e9;border-radius:20px}ion-item[_ngcontent-%COMP%]:hover{cursor:pointer;--background:var(--ion-color-light)}"]}),t})(),N=(()=>{class t{}return t.\u0275mod=h.Hb({type:t}),t.\u0275inj=h.Gb({factory:function(e){return new(e||t)},imports:[[n.b,s.a,i.U]]}),t})();o.d(e,"HomePageModule",(function(){return S}));let S=(()=>{class t{}return t.\u0275mod=h.Hb({type:t}),t.\u0275inj=h.Gb({factory:function(e){return new(e||t)},imports:[[n.b,s.a,i.U,c.h.forChild([{path:"",component:z}]),N]]}),t})()}}]);