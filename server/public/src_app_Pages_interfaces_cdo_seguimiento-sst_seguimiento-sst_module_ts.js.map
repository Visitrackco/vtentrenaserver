{"version":3,"file":"src_app_Pages_interfaces_cdo_seguimiento-sst_seguimiento-sst_module_ts.js","mappings":"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","sources":["./src/app/Pages/interfaces/cdo/seguimiento-sst/seguimiento-sst-routing.module.ts","./src/app/Pages/interfaces/cdo/seguimiento-sst/seguimiento-sst.module.ts","./src/app/Pages/interfaces/cdo/seguimiento-sst/seguimiento-sst.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { SeguimientoSSTPage } from './seguimiento-sst.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: SeguimientoSSTPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class SeguimientoSSTPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { SeguimientoSSTPageRoutingModule } from './seguimiento-sst-routing.module';\n\nimport { SeguimientoSSTPage } from './seguimiento-sst.page';\nimport { PipesModule } from 'src/app/Pipes/pipes.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    SeguimientoSSTPageRoutingModule,\n    PipesModule\n  ],\n  declarations: [SeguimientoSSTPage]\n})\nexport class SeguimientoSSTPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { AlertController, ModalController, PopoverController, ToastController } from '@ionic/angular';\nimport { OpcionesCDOComponent } from 'src/app/components/opciones-cdo/opciones-cdo.component';\nimport { ApiService } from 'src/app/Services/Api/Api.service';\nimport * as _ from 'underscore'\nimport * as moment from 'moment-timezone'\nimport { ActivatedRoute } from '@angular/router';\nimport { ControlcdoasistencialComponent } from 'src/app/components/controlcdoasistencial/controlcdoasistencial.component';\nimport { LoadingService } from 'src/app/Services/Utilities/Loading.service';\nimport { setInterval } from 'timers';\nimport { ToastService } from 'src/app/Services/Utilities/Toast.service';\nimport { StorageWebService } from 'src/app/Services/Storage/StorageWeb.service';\n\n@Component({\n  selector: 'app-seguimiento-sst',\n  templateUrl: './seguimiento-sst.page.html',\n  styleUrls: ['./seguimiento-sst.page.scss'],\n})\nexport class SeguimientoSSTPage implements OnInit {\n\n\n  login = '';\n  password = '';\n\n  form;\n  interface;\n\n  load = true;\n  activitiesList = [];\n\n  tkn = '';\n  clientes = [];\n\n  desde = '';\n  hasta = '';\n\n  user;\n  txt = '';\n\n\n  constructor(\n    private storage: StorageWebService,\n    private toast: ToastService,\n    private route: ActivatedRoute,\n    private api: ApiService,\n    private popover: PopoverController,\n    private loading: LoadingService\n  ) { }\n\n  ngOnInit() {\n   \n  }\n\n  getInfo(guid) {\n    return new Promise((resolve, reject) => {\n      this.api.getActivitieInfo(this.tkn, guid).subscribe((data) => {\n        if (data) {\n          resolve(data)\n        } else {\n          resolve (false)\n        }\n      })\n    })\n  }\n\n\n  ionViewWillEnter() {\n\n    this.route.queryParams.subscribe((param) => {\n      console.log(param);\n      this.tkn = param.tkn;\n  \n    })\n\n  \n   \n  }\n\n  // A64B1EB5-C279-4F96-9F90-3EC5325BF53D\n\n  returnValue(arr, api) {\n    const value = arr.filter((item) => item.apiId == api)\n    return value.length > 0 ? value[0].Value : ''\n  }\n\n  async aplicar() {\n\n    moment.locale('es');\n    if (!this.desde || !this.hasta) {\n      this.toast.newCreatedToast('Debes ingresar la fecha desde y hasta', false)\n      return;\n    }\n\n    console.log(this.desde, this.hasta)\n    this.load = false;\n\n    this.activitiesList = [];\n\n\n    this.api.getActivities2(this.tkn,this.desde + ' 00:00', this.hasta + ' 23:59', 'A64B1EB5-C279-4F96-9F90-3EC5325BF53D').subscribe(async (data : any) => {\n      console.log(data, 'data')\n     // const rs = data.filter((it) => it.LocationName == lg[0].loc.Name)\n\n     for (const item of data) {\n      let rsData: any = await this.getInfo(item.GUID)\n      rsData.creado = moment(rsData.CreatedOn).format('LL')\n      rsData.creadoName =rsData.CreatedByName ? rsData.CreatedByName : rsData.AssignedToName;\n      rsData.items = [];\n      rsData.seguimientos = [];\n\n      if (rsData.CreatedOn >= this.desde && rsData.CreatedOn <= this.hasta) {\n\n\n\n      let show = false;\n\n      let seguimientos = rsData.Values.filter((it) => it.apiId == 'SEGUIMIENTOS');\n\n      if (seguimientos.length > 0) {\n        seguimientos[0].Value.forEach((ele) => {\n          if (ele.Value.length > 0) {\n            let obj = {\n              name : this.returnValue(ele.Value, 'name'),\n              fecha : this.returnValue(ele.Value, 'FECHA'),\n              estado : this.returnValue(ele.Value, 'ESTADO'),\n              obs : this.returnValue(ele.Value, 'OBSERVACION'),\n              foto : this.returnValue(ele.Value, 'FOTO'),\n              seguimiento : this.returnValue(ele.Value, 'SEGUIMIENTO'),\n              \n            }\n\n            rsData.seguimientos.push(obj)\n\n          }\n        })\n      }\n\n      for (let i = 1; i <= 61; i++) {\n        \n        let existValues = rsData.Values.filter((it) => it.apiId == i.toString());\n      //  console.log(existValues);\n        \n        if (existValues.length > 0) {\n          if (existValues[0].Value == 'NC') {\n\n            const comp = rsData.seguimientos.filter((item) => item.name == i.toString() && item.estado == 'CERRADO')\n\n            if (rsData.seguimientos.length == 0) {\n              show = true;\n            }\n\n            if (comp.length == 0) {\n              show = true;\n\n              let obj = {\n                item: i,\n                hallazgo: this.returnValue(rsData.Values, i +'HALLAZGOS'),\n                reco: this.returnValue(rsData.Values, i +'RECOMENDACION'),\n                foto: this.returnValue(rsData.Values, i +'FOTO'),\n                seguimiento: this.returnValue(rsData.Values, i +'SEGUIMIENTO')\n              }\n               rsData.items.push(obj);\n            }\n            \n           \n          }\n          \n        }\n      }\n    \n\n\n      if (show) {\n        this.activitiesList.push(rsData);\n      }\n\n          }\n    }\n\n    this.activitiesList = _.sortBy(this.activitiesList, 'CreatedOn')\n\n\n\n      this.load = true\n\n      console.log(this.activitiesList)\n    }, () => {this.load = true}) \n    \n  }\n\n  async cambio(event) {\n    this.txt = event.detail.value;\n  }\n\n\n  reenviar(item) {\n\n    console.log(item)\n\n\n\n    this.loading.createLoading('Reenviando Planeación')\n\n    this.api.changeDispath({\n      tkn: this.tkn,\n      user: item.Updated_GUID,\n      status: item.CompanyStatusGUID,\n      date: moment().add(2, 'minutes').format('YYYY-MM-DD HH:mm'),\n      guid: item.GUID\n    }).subscribe(async (data: any) => {\n      if (data) {\n      \n        this.toast.newCreatedToast('Inspecciòn reenviada', true)\n\n      }\n\n      this.loading.cancelLoading()\n    }, (err) => {\n      this.loading.cancelLoading()\n    })\n\n  }\n\n\n}\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}