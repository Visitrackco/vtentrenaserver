(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{EpjX:function(e,t,n){"use strict";n.r(t);var o=n("ofXK"),c=n("3Pt+"),s=n("TEn/"),i=n("tyNb"),r=n("mrSG"),a=n("NIW7"),b=n("lNB8"),m=n("VOof"),l=n("w9U0"),d=n("fXoL");function h(e,t){if(1&e){const e=d.Nb();d.Mb(0,"ion-button",5),d.Ub("click",(function(){return d.hc(e),d.Wb().cancel()})),d.lc(1,"CANCELAR RESPUESTA"),d.Lb()}}function p(e,t){if(1&e){const e=d.Nb();d.Mb(0,"div",11),d.Mb(1,"strong"),d.lc(2),d.Lb(),d.Kb(3,"br"),d.Mb(4,"p"),d.lc(5),d.Lb(),d.Kb(6,"br"),d.Mb(7,"div",8),d.Ub("click",(function(){d.hc(e);const t=d.Wb(),n=t.$implicit,o=t.index;return d.Wb().answerComment(n,o)})),d.lc(8,"Responder"),d.Lb(),d.Mb(9,"div",9),d.lc(10),d.Lb(),d.Lb()}if(2&e){const e=t.$implicit;d.zb(2),d.mc(e.name),d.zb(3),d.mc(e.message),d.zb(5),d.mc(e.dateCreated)}}function g(e,t){if(1&e){const e=d.Nb();d.Mb(0,"div",6),d.Mb(1,"div",7),d.Mb(2,"strong"),d.lc(3),d.Lb(),d.Kb(4,"br"),d.Mb(5,"p"),d.lc(6),d.Lb(),d.Kb(7,"br"),d.Mb(8,"div",8),d.Ub("click",(function(){d.hc(e);const n=t.$implicit,o=t.index;return d.Wb().answerComment(n,o)})),d.lc(9,"Responder"),d.Lb(),d.Mb(10,"div",9),d.lc(11),d.Lb(),d.Lb(),d.kc(12,p,11,3,"div",10),d.Lb()}if(2&e){const e=t.$implicit;d.zb(3),d.mc(e.user.name),d.zb(3),d.mc(e.message),d.zb(5),d.mc(e.dateCreated),d.zb(1),d.cc("ngForOf",e.answers)}}function u(e,t){if(1&e){const e=d.Nb();d.Mb(0,"ion-textarea",17),d.Ub("ngModelChange",(function(t){return d.hc(e),d.Wb(2).comment=t})),d.Lb()}if(2&e){const e=d.Wb(2);d.cc("ngModel",e.comment)}}function f(e,t){if(1&e){const e=d.Nb();d.Mb(0,"ion-button",18),d.Ub("click",(function(){return d.hc(e),d.Wb(2).createComment()})),d.lc(1,"ENVIAR"),d.Lb()}}function C(e,t){if(1&e){const e=d.Nb();d.Mb(0,"ion-textarea",19),d.Ub("ngModelChange",(function(t){return d.hc(e),d.Wb(2).comment=t})),d.Lb()}if(2&e){const e=d.Wb(2);d.ec("placeholder","Escribe una respuesta en el comentario de ",e.userRespon,""),d.cc("ngModel",e.comment)}}function M(e,t){if(1&e){const e=d.Nb();d.Mb(0,"ion-button",20),d.Ub("click",(function(){return d.hc(e),d.Wb(2).createCommentChildren()})),d.lc(1,"RESPONDER"),d.Lb()}if(2&e){const e=d.Wb(2);d.cc("disabled",""===e.userRespon)}}function w(e,t){if(1&e&&(d.Mb(0,"div",12),d.kc(1,u,1,1,"ion-textarea",13),d.kc(2,f,2,0,"ion-button",14),d.kc(3,C,1,2,"ion-textarea",15),d.kc(4,M,2,1,"ion-button",16),d.Lb()),2&e){const e=d.Wb();d.zb(1),d.cc("ngIf",""===e.commentParent),d.zb(1),d.cc("ngIf",""===e.commentParent),d.zb(1),d.cc("ngIf",""!==e.commentParent),d.zb(1),d.cc("ngIf",""!==e.commentParent)}}function k(e,t){if(1&e){const e=d.Nb();d.Mb(0,"div",12),d.Mb(1,"ion-textarea",19),d.Ub("ngModelChange",(function(t){return d.hc(e),d.Wb().comment=t})),d.Lb(),d.Mb(2,"ion-button",20),d.Ub("click",(function(){return d.hc(e),d.Wb().createCommentChildren()})),d.lc(3,"RESPONDER"),d.Lb(),d.Lb()}if(2&e){const e=d.Wb();d.zb(1),d.ec("placeholder","Escribe una respuesta en el comentario de ",e.userRespon,""),d.cc("ngModel",e.comment),d.zb(1),d.cc("disabled",""===e.userRespon)}}const v=[{path:"",component:(()=>{class e{constructor(e,t,n,o,c,s){this.modalCtrl=e,this.storage=t,this.apiEntrena=n,this.toasCtrl=o,this.active=c,this.dtacompany=s,this.color="",this.comment="",this.comments=[],this.role="",this.userRespon="",this.commentParent="",this.dtacompany.$color.subscribe(e=>{this.color=e})}ngOnInit(){}ionViewWillEnter(){this.getComments()}getComments(){return Object(r.a)(this,void 0,void 0,(function*(){const e=yield this.storage.getLogin();e&&(this.role=e[0].data.role,"USER_ENTRENA"===e[0].data.ro9le?this.apiEntrena.getComments({desing:this.active.snapshot.paramMap.get("id")},e[0].token).subscribe(t=>{if(console.log(t),"ok"===t.status){let n=t.response.length;t.response.forEach(o=>Object(r.a)(this,void 0,void 0,(function*(){new Promise((t,n)=>{this.apiEntrena.getCommentChildrens({commentParent:o._id},e[0].token).subscribe(e=>{console.log(e,"respuesta"),o.answers="ok"===e.status?e.response:[],t(!0)},e=>{o.answers=[],t(!0)})}).then(()=>{n-=1,0===n&&(this.comments=t.response)})})))}else this.toasCtrl.newCreatedToast("No se pudo obtener los comentarios",!1)},e=>{this.toasCtrl.newCreatedToast("No se pudo obtener los comentarios",!1)}):this.apiEntrena.getCommentsAdmin({desing:this.active.snapshot.paramMap.get("id")},e[0].token).subscribe(t=>{if(console.log(t),"ok"===t.status){let n=t.response.length;t.response.forEach(o=>Object(r.a)(this,void 0,void 0,(function*(){new Promise((t,n)=>{this.apiEntrena.getCommentChildrens({commentParent:o._id},e[0].token).subscribe(e=>{console.log(e,"respuesta"),o.answers="ok"===e.status?e.response:[],t(!0)},e=>{o.answers=[],t(!0)})}).then(()=>{n-=1,0===n&&(this.comments=t.response)})})))}else this.toasCtrl.newCreatedToast("No se pudo obtener los comentarios",!1)},e=>{this.toasCtrl.newCreatedToast("No se pudo obtener los comentarios",!1)}))}))}createComment(){return Object(r.a)(this,void 0,void 0,(function*(){const e=yield this.storage.getLogin();e&&this.apiEntrena.comments({comment:this.comment,desing:this.active.snapshot.paramMap.get("id")},e[0].token).subscribe(e=>{console.log(e),"ok"===e.status?(this.comments.push(e.response),this.toasCtrl.newCreatedToast("Comentario enviado",!0)):this.toasCtrl.newCreatedToast("No se pudo crear el comentario",!1)},e=>{this.toasCtrl.newCreatedToast("No se pudo crear el comentario",!1)})}))}answerComment(e,t){return Object(r.a)(this,void 0,void 0,(function*(){this.userRespon=e.user.name,this.commentParent=e._id}))}cancel(){this.userRespon="",this.commentParent=""}createCommentChildren(){return Object(r.a)(this,void 0,void 0,(function*(){const e=yield this.storage.getLogin();e&&this.apiEntrena.createCommentChildrens({commentParent:this.commentParent,comment:this.comment},e[0].token).subscribe(e=>{if(console.log(e),"ok"===e.status){const t=this.comments.findIndex(e=>e._id===this.commentParent);this.comments[t].answers.push(e.response),this.toasCtrl.newCreatedToast("Respuesta enviada",!0),this.cancel()}else this.toasCtrl.newCreatedToast("No se pudo crear el comentario",!1)},e=>{this.toasCtrl.newCreatedToast("No se pudo crear el comentario",!1)})}))}}return e.\u0275fac=function(t){return new(t||e)(d.Jb(s.Y),d.Jb(m.a),d.Jb(a.a),d.Jb(l.a),d.Jb(i.a),d.Jb(b.a))},e.\u0275cmp=d.Db({type:e,selectors:[["app-comments"]],decls:11,vars:6,consts:[[3,"color"],["slot","end","mode","ios","color","medium",3,"click",4,"ngIf"],[1,"ion-padding"],["class","comment",4,"ngFor","ngForOf"],["class","flex",4,"ngIf"],["slot","end","mode","ios","color","medium",3,"click"],[1,"comment"],[1,"info"],[1,"respon",3,"click"],[1,"date"],["class","answer",4,"ngFor","ngForOf"],[1,"answer"],[1,"flex"],["class","campo","placeholder","Escribe un comentario",3,"ngModel","ngModelChange",4,"ngIf"],["mode","ios","color","light",3,"click",4,"ngIf"],["class","campo",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],["mode","ios","color","light",3,"disabled","click",4,"ngIf"],["placeholder","Escribe un comentario",1,"campo",3,"ngModel","ngModelChange"],["mode","ios","color","light",3,"click"],[1,"campo",3,"ngModel","placeholder","ngModelChange"],["mode","ios","color","light",3,"disabled","click"]],template:function(e,t){1&e&&(d.Mb(0,"ion-header"),d.Mb(1,"ion-toolbar",0),d.Mb(2,"ion-title"),d.lc(3,"Comentarios"),d.Lb(),d.kc(4,h,2,0,"ion-button",1),d.Lb(),d.Lb(),d.Mb(5,"ion-content",2),d.kc(6,g,13,4,"div",3),d.Lb(),d.Mb(7,"ion-footer"),d.Mb(8,"ion-toolbar",0),d.kc(9,w,5,4,"div",4),d.kc(10,k,4,3,"div",4),d.Lb(),d.Lb()),2&e&&(d.zb(1),d.cc("color",t.color),d.zb(3),d.cc("ngIf",""!==t.commentParent),d.zb(2),d.cc("ngForOf",t.comments),d.zb(2),d.cc("color",t.color),d.zb(1),d.cc("ngIf","USER_ENTRENA"===t.role),d.zb(1),d.cc("ngIf","ADMIN_ENTRENA"===t.role))},directives:[s.s,s.T,s.S,o.i,s.l,o.h,s.q,s.g,s.R,s.fb,c.c,c.d],styles:[".campo[_ngcontent-%COMP%]{min-width:calc(100% - 200px);width:80%;padding:10px}.flex[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.flex[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{min-width:200px}.comment[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:20px}.comment[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;padding:10px;background-color:#f1f1ff;margin-bottom:10px;border-bottom:1px solid rgba(0,0,0,.1)}.comment[_ngcontent-%COMP%]   .answer[_ngcontent-%COMP%]{width:80%;margin-left:20%;padding:10px;margin-top:5px;background-color:#f1f1f1}.comment[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{line-height:1.8}.date[_ngcontent-%COMP%]{opacity:.3;margin-top:5px}.respon[_ngcontent-%COMP%]{color:#00f;cursor:pointer;font-weight:700;font-size:14px}"]}),e})()}];let P=(()=>{class e{}return e.\u0275mod=d.Hb({type:e}),e.\u0275inj=d.Gb({factory:function(t){return new(t||e)},imports:[[i.h.forChild(v)],i.h]}),e})();n.d(t,"CommentsPageModule",(function(){return E}));let E=(()=>{class e{}return e.\u0275mod=d.Hb({type:e}),e.\u0275inj=d.Gb({factory:function(t){return new(t||e)},imports:[[o.b,c.a,s.U,P]]}),e})()}}]);