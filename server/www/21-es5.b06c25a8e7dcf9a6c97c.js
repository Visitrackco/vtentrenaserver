function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{EpjX:function(e,n,t){"use strict";t.r(n);var o=t("ofXK"),r=t("3Pt+"),c=t("TEn/"),i=t("tyNb"),a=t("mrSG"),s=t("NIW7"),m=t("lNB8"),l=t("VOof"),u=t("w9U0"),b=t("fXoL");function d(e,n){if(1&e){var t=b.Nb();b.Mb(0,"ion-button",5),b.Ub("click",(function(){return b.hc(t),b.Wb().cancel()})),b.lc(1,"CANCELAR RESPUESTA"),b.Lb()}}function f(e,n){if(1&e){var t=b.Nb();b.Mb(0,"div",11),b.Mb(1,"strong"),b.lc(2),b.Lb(),b.Kb(3,"br"),b.Mb(4,"p"),b.lc(5),b.Lb(),b.Kb(6,"br"),b.Mb(7,"div",8),b.Ub("click",(function(){b.hc(t);var e=b.Wb(),n=e.$implicit,o=e.index;return b.Wb().answerComment(n,o)})),b.lc(8,"Responder"),b.Lb(),b.Mb(9,"div",9),b.lc(10),b.Lb(),b.Lb()}if(2&e){var o=n.$implicit;b.zb(2),b.mc(o.name),b.zb(3),b.mc(o.message),b.zb(5),b.mc(o.dateCreated)}}function p(e,n){if(1&e){var t=b.Nb();b.Mb(0,"div",6),b.Mb(1,"div",7),b.Mb(2,"strong"),b.lc(3),b.Lb(),b.Kb(4,"br"),b.Mb(5,"p"),b.lc(6),b.Lb(),b.Kb(7,"br"),b.Mb(8,"div",8),b.Ub("click",(function(){b.hc(t);var e=n.$implicit,o=n.index;return b.Wb().answerComment(e,o)})),b.lc(9,"Responder"),b.Lb(),b.Mb(10,"div",9),b.lc(11),b.Lb(),b.Lb(),b.kc(12,f,11,3,"div",10),b.Lb()}if(2&e){var o=n.$implicit;b.zb(3),b.mc(o.user.name),b.zb(3),b.mc(o.message),b.zb(5),b.mc(o.dateCreated),b.zb(1),b.cc("ngForOf",o.answers)}}function g(e,n){if(1&e){var t=b.Nb();b.Mb(0,"ion-textarea",17),b.Ub("ngModelChange",(function(e){return b.hc(t),b.Wb(2).comment=e})),b.Lb()}if(2&e){var o=b.Wb(2);b.cc("ngModel",o.comment)}}function h(e,n){if(1&e){var t=b.Nb();b.Mb(0,"ion-button",18),b.Ub("click",(function(){return b.hc(t),b.Wb(2).createComment()})),b.lc(1,"ENVIAR"),b.Lb()}}function C(e,n){if(1&e){var t=b.Nb();b.Mb(0,"ion-textarea",19),b.Ub("ngModelChange",(function(e){return b.hc(t),b.Wb(2).comment=e})),b.Lb()}if(2&e){var o=b.Wb(2);b.ec("placeholder","Escribe una respuesta en el comentario de ",o.userRespon,""),b.cc("ngModel",o.comment)}}function v(e,n){if(1&e){var t=b.Nb();b.Mb(0,"ion-button",20),b.Ub("click",(function(){return b.hc(t),b.Wb(2).createCommentChildren()})),b.lc(1,"RESPONDER"),b.Lb()}if(2&e){var o=b.Wb(2);b.cc("disabled",""===o.userRespon)}}function w(e,n){if(1&e&&(b.Mb(0,"div",12),b.kc(1,g,1,1,"ion-textarea",13),b.kc(2,h,2,0,"ion-button",14),b.kc(3,C,1,2,"ion-textarea",15),b.kc(4,v,2,1,"ion-button",16),b.Lb()),2&e){var t=b.Wb();b.zb(1),b.cc("ngIf",""===t.commentParent),b.zb(1),b.cc("ngIf",""===t.commentParent),b.zb(1),b.cc("ngIf",""!==t.commentParent),b.zb(1),b.cc("ngIf",""!==t.commentParent)}}function k(e,n){if(1&e){var t=b.Nb();b.Mb(0,"div",12),b.Mb(1,"ion-textarea",19),b.Ub("ngModelChange",(function(e){return b.hc(t),b.Wb().comment=e})),b.Lb(),b.Mb(2,"ion-button",20),b.Ub("click",(function(){return b.hc(t),b.Wb().createCommentChildren()})),b.lc(3,"RESPONDER"),b.Lb(),b.Lb()}if(2&e){var o=b.Wb();b.zb(1),b.ec("placeholder","Escribe una respuesta en el comentario de ",o.userRespon,""),b.cc("ngModel",o.comment),b.zb(1),b.cc("disabled",""===o.userRespon)}}var M,x,P=[{path:"",component:(M=function(){function e(n,t,o,r,c,i){var a=this;_classCallCheck(this,e),this.modalCtrl=n,this.storage=t,this.apiEntrena=o,this.toasCtrl=r,this.active=c,this.dtacompany=i,this.color="",this.comment="",this.comments=[],this.role="",this.userRespon="",this.commentParent="",this.dtacompany.$color.subscribe((function(e){a.color=e}))}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ionViewWillEnter",value:function(){this.getComments()}},{key:"getComments",value:function(){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.getLogin();case 2:(n=e.sent)&&(this.role=n[0].data.role,"USER_ENTRENA"===n[0].data.ro9le?this.apiEntrena.getComments({desing:this.active.snapshot.paramMap.get("id")},n[0].token).subscribe((function(e){if(console.log(e),"ok"===e.status){var o=e.response.length;e.response.forEach((function(r){return Object(a.a)(t,void 0,void 0,regeneratorRuntime.mark((function t(){var c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:new Promise((function(e,t){c.apiEntrena.getCommentChildrens({commentParent:r._id},n[0].token).subscribe((function(n){console.log(n,"respuesta"),r.answers="ok"===n.status?n.response:[],e(!0)}),(function(n){r.answers=[],e(!0)}))})).then((function(){0==(o-=1)&&(c.comments=e.response)}));case 1:case"end":return t.stop()}}),t)})))}))}else t.toasCtrl.newCreatedToast("No se pudo obtener los comentarios",!1)}),(function(e){t.toasCtrl.newCreatedToast("No se pudo obtener los comentarios",!1)})):this.apiEntrena.getCommentsAdmin({desing:this.active.snapshot.paramMap.get("id")},n[0].token).subscribe((function(e){if(console.log(e),"ok"===e.status){var o=e.response.length;e.response.forEach((function(r){return Object(a.a)(t,void 0,void 0,regeneratorRuntime.mark((function t(){var c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:new Promise((function(e,t){c.apiEntrena.getCommentChildrens({commentParent:r._id},n[0].token).subscribe((function(n){console.log(n,"respuesta"),r.answers="ok"===n.status?n.response:[],e(!0)}),(function(n){r.answers=[],e(!0)}))})).then((function(){0==(o-=1)&&(c.comments=e.response)}));case 1:case"end":return t.stop()}}),t)})))}))}else t.toasCtrl.newCreatedToast("No se pudo obtener los comentarios",!1)}),(function(e){t.toasCtrl.newCreatedToast("No se pudo obtener los comentarios",!1)})));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"createComment",value:function(){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.getLogin();case 2:(n=e.sent)&&this.apiEntrena.comments({comment:this.comment,desing:this.active.snapshot.paramMap.get("id")},n[0].token).subscribe((function(e){console.log(e),"ok"===e.status?(t.comments.push(e.response),t.toasCtrl.newCreatedToast("Comentario enviado",!0)):t.toasCtrl.newCreatedToast("No se pudo crear el comentario",!1)}),(function(e){t.toasCtrl.newCreatedToast("No se pudo crear el comentario",!1)}));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"answerComment",value:function(e,n){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.userRespon=e.user.name,this.commentParent=e._id;case 1:case"end":return n.stop()}}),n,this)})))}},{key:"cancel",value:function(){this.userRespon="",this.commentParent=""}},{key:"createCommentChildren",value:function(){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.getLogin();case 2:(n=e.sent)&&this.apiEntrena.createCommentChildrens({commentParent:this.commentParent,comment:this.comment},n[0].token).subscribe((function(e){if(console.log(e),"ok"===e.status){var n=t.comments.findIndex((function(e){return e._id===t.commentParent}));t.comments[n].answers.push(e.response),t.toasCtrl.newCreatedToast("Respuesta enviada",!0),t.cancel()}else t.toasCtrl.newCreatedToast("No se pudo crear el comentario",!1)}),(function(e){t.toasCtrl.newCreatedToast("No se pudo crear el comentario",!1)}));case 4:case"end":return e.stop()}}),e,this)})))}}]),e}(),M.\u0275fac=function(e){return new(e||M)(b.Jb(c.Y),b.Jb(l.a),b.Jb(s.a),b.Jb(u.a),b.Jb(i.a),b.Jb(m.a))},M.\u0275cmp=b.Db({type:M,selectors:[["app-comments"]],decls:11,vars:6,consts:[[3,"color"],["slot","end","mode","ios","color","medium",3,"click",4,"ngIf"],[1,"ion-padding"],["class","comment",4,"ngFor","ngForOf"],["class","flex",4,"ngIf"],["slot","end","mode","ios","color","medium",3,"click"],[1,"comment"],[1,"info"],[1,"respon",3,"click"],[1,"date"],["class","answer",4,"ngFor","ngForOf"],[1,"answer"],[1,"flex"],["class","campo","placeholder","Escribe un comentario",3,"ngModel","ngModelChange",4,"ngIf"],["mode","ios","color","light",3,"click",4,"ngIf"],["class","campo",3,"ngModel","placeholder","ngModelChange",4,"ngIf"],["mode","ios","color","light",3,"disabled","click",4,"ngIf"],["placeholder","Escribe un comentario",1,"campo",3,"ngModel","ngModelChange"],["mode","ios","color","light",3,"click"],[1,"campo",3,"ngModel","placeholder","ngModelChange"],["mode","ios","color","light",3,"disabled","click"]],template:function(e,n){1&e&&(b.Mb(0,"ion-header"),b.Mb(1,"ion-toolbar",0),b.Mb(2,"ion-title"),b.lc(3,"Comentarios"),b.Lb(),b.kc(4,d,2,0,"ion-button",1),b.Lb(),b.Lb(),b.Mb(5,"ion-content",2),b.kc(6,p,13,4,"div",3),b.Lb(),b.Mb(7,"ion-footer"),b.Mb(8,"ion-toolbar",0),b.kc(9,w,5,4,"div",4),b.kc(10,k,4,3,"div",4),b.Lb(),b.Lb()),2&e&&(b.zb(1),b.cc("color",n.color),b.zb(3),b.cc("ngIf",""!==n.commentParent),b.zb(2),b.cc("ngForOf",n.comments),b.zb(2),b.cc("color",n.color),b.zb(1),b.cc("ngIf","USER_ENTRENA"===n.role),b.zb(1),b.cc("ngIf","ADMIN_ENTRENA"===n.role))},directives:[c.s,c.T,c.S,o.i,c.l,o.h,c.q,c.g,c.R,c.fb,r.c,r.d],styles:[".campo[_ngcontent-%COMP%]{min-width:calc(100% - 200px);width:80%;padding:10px}.flex[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.flex[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{min-width:200px}.comment[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:20px}.comment[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;padding:10px;background-color:#f1f1ff;margin-bottom:10px;border-bottom:1px solid rgba(0,0,0,.1)}.comment[_ngcontent-%COMP%]   .answer[_ngcontent-%COMP%]{width:80%;margin-left:20%;padding:10px;margin-top:5px;background-color:#f1f1f1}.comment[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{line-height:1.8}.date[_ngcontent-%COMP%]{opacity:.3;margin-top:5px}.respon[_ngcontent-%COMP%]{color:#00f;cursor:pointer;font-weight:700;font-size:14px}"]}),M)}],R=((x=function e(){_classCallCheck(this,e)}).\u0275mod=b.Hb({type:x}),x.\u0275inj=b.Gb({factory:function(e){return new(e||x)},imports:[[i.h.forChild(P)],i.h]}),x);t.d(n,"CommentsPageModule",(function(){return L}));var E,L=((E=function e(){_classCallCheck(this,e)}).\u0275mod=b.Hb({type:E}),E.\u0275inj=b.Gb({factory:function(e){return new(e||E)},imports:[[o.b,r.a,c.U,R]]}),E)}}]);